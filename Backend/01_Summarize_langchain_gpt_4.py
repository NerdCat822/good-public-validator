import openai
import os
from langchain_openai.chat_models import ChatOpenAI
from langchain.schema import SystemMessage, HumanMessage
from langchain.prompts.chat import (
    ChatPromptTemplate,
    HumanMessagePromptTemplate,
)
from langchain.schema import StrOutputParser
from dotenv import load_dotenv
load_dotenv()

openai.api_key = os.getenv('OPENAI_API_KEY')
openai.azure_endpoint = os.getenv('AZURE_ENDPOINT')
openai.api_type = os.getenv('API_TYPE')
openai.api_version = os.getenv('API_VERSION')

model1 = "gpt-3.5-turbo"
model2 = "gpt-4-1106-preview"
llm = ChatOpenAI(model=model2)

# 요약 template
summarize_human_message_prompt = "'{text}' 이 내용 bullet point 사용해서 3줄 요약해줘"
summarize_human_message_prompt_template = HumanMessagePromptTemplate.from_template(summarize_human_message_prompt)
summarize_chat_prompt_template = ChatPromptTemplate.from_messages([summarize_human_message_prompt])

chain = summarize_chat_prompt_template | llm | StrOutputParser()


bad_texts = """
9급 욕하는 새끼들 특징이 



이상하게 현실세계에서 공부 잘하는 새끼들이나 아니면 어설프게라도 대학물 먹은애들은 욕 잘 안한다.



꼭 고졸 생산직, 좆소 영업직, 차팔이, 타이어팔이... 이런 ㅎㅌㅊ 인생 사는새끼들이 기를쓰고 욕함.



왜냐, 이새끼들은 지들이 '20살부터 돈을 벌어왔다는' 자부심이 상상외로 엄청나게 강함.



공고졸업하고 몸쓰는 일하는 새끼들 공통적인 특징이 뭐냐, 



대부분 집안이 별볼일 없는집안, 가난한 집안이라는거야.



사람은 누구나 자기가 가진걸로 그 세계를 평가한다.



본인의 가난한, 앰생 집안을 대입함과 동시에



이제 9급이 되면? 이라고 머리를 굴리는거지.



그래서 이새끼들이 맨날 9급 까는 코스가 비슷해.



"박봉이다, 찌질이다, 평생 가난하다, 그돈 받을거면 왜하냐? " 



이런식으로 욕을하면서 본인의 학벌 열등감과 



사회적으로 천대받는 본인의 직업에 대한 방어의식이 작동하는거지.



내가 주변 친구들 보면서 느낀게 공무원 까는 새끼들 공통적인 특징



1. 못배운 새끼들. 기술하는 새끼들. 자영업 하는 새끼들 -> 사회적으로 천대받는 직업



2. 대학은 다녀도 '집안이 가난한' 새끼들. 이새끼들도 본인이 가난해서 세상을 돈으로만 바라봄.



아니 시발 돈으로만 따지면 창녀가 검사보다 위 아니냐? ㅋㅋㅋ



내가 장인이어도 딸자식 줄때 9급이랑 고졸 생산직새끼랑 데려오면 9급한테 주겠다. 



9급 붙으면 상위 15%안에 들어가고 7급붙으면 5%안에 들어간다.



그만큼 대다수의 사람은 생산직, 좆소, 영세 자영업 하는 사람이 대한민국 80%임.



7급 5%라하면 또 말도 안된다 할텐데, 



건동홍이 상위 5%, 인터넷에서 지잡이라 까이는 국숭세단이 7~8%임.



아무튼 공시생들 본인이 이거 하기로 마음먹었으면 근거없는 자부심은 지양하더라도



비하하는 새끼들 말에 너무 슬퍼하지마라.



세상은 손가락으로 두드리는 키보드 너머에 있다. 
"""
bad_text2 = """
왜 이런 일이 일어나고 있는 거야? 기초수급비용을 왜 이렇게 적게 주는 거야? 내가 이미 너희들에게 얼마나 돈을 받아야 하는데? 더 이상 날 괴롭히지 마! 내 돈으로 무엇을 하는지 말해봐!

그냥 가라. 너희들은 어디서 이 모든 돈을 사용하고 있는 거야? 내가 도대체 뭘 위해서 받는 건데? 나는 이런 불공평한 일을 더 이상 참지 않겠어!
"""
tt = "**1. 영화사의 시작**영화는 사진과 기술의 발전을 기반으로 형성되었습니다. 19세기 말에 발명가들은 이미지를 촬영하고 재생할 수 있는 장치를 개발하기 시작했습니다. 1888년에 토머스 에디슨은 키네토스코프를 발명했는데, 이는 영화를 개인적으로 시청할 수 있도록 하는 장치였습니다. 1895년에는 루이 뤼미에르가 시네마토그래프를 발명했는데, 이는 영화를 프로젝터로 대형 스크린에 상영할 수 있도록 하는 장치였습니다.\n\n**2. 초기 영화의 특징**\n\n초기 영화는 매우 단순했습니다. 일반적으로 몇 분 길이였고, 흑백으로 촬영되었습니다. 줄거리도 간단했고, 특수 효과도 거의 없었습니다. 그러나 초기 영화는 청중에게 큰 인기를 끌었습니다. 그들은 새로운 형태의 오락이었고, 사람들은 영화관에 가서 움직이는 이미지를 보는 것을 좋아했습니다.\n\n**3. 영화의 기술적 진화**\n\n20세기 초에 영화는 빠르게 발전했습니다. 새로운 영화 기술이 개발되었고, 영화의 길이와 복잡성이 증가했습니다. 영화는 또한 컬러로 촬영되기 시작했습니다. 1927년에는 워너 브라더스가 최초의 유성 영화인 《재즈 싱어》를 개봉했습니다. 이 영화는 큰 성공을 거두었고, 영화 산업에 혁명을 일으켰습니다.\n\n**4. 영화의 장르와 양식의 발전**\n\n20세기 초에 영화는 다양한 장르와 양식으로 나뉘기 시작했습니다. 코미디, 드라마, 액션, 공포 등의 장르가 등장했고, 각 장르는 독특한 스타일과 관습을 가지고 있었습니다. 영화의 양식도 발전했는데, 리얼리즘, 익스프레셔니즘, 신파주의 등의 양식이 등장했습니다.\n\n**5. 영화의 사회적 영향**\n\n영화는 처음부터 사회에 큰 영향을 미쳤습니다. 영화는 사람들의 가치관과 행동에 영향을 미칠 수 있었고, 사회 문제에 대한 인식을 높일 수 있었습니다. 영화는 또한 사람들을 단결시키고, 전쟁과 기근 등의 어려운 시기를 극복하는 데 도움이 되었습니다.\n\n**6. 영화의 미학적 변화**\n\n20세기 초에 영화의 미학은 빠르게 변화했습니다. 영화 작가들은 새로운 시각적 기법을 실험하기 시작했고, 영화의 미학적 가치가 점차 높아졌습니다. 영화는 예술 형식으로 인정받기 시작했고, 영화 작가들은 예술가로서 존중받기 시작했습니다.\n\n**7. 영화의 경제적 중요성**\n\n영화는 20세기 초에 빠르게 성장하는 산업이 되었습니다. 영화관이 전 세계적으로 건설되었고, 영화 산업은 수많은 사람들에게 일자리를 제공했습니다. 영화는 또한 중요한 수출품이 되었고, 국가 경제에 기여했습니다.\n\n**8. 영화의 미래**\n\n영화의 미래는 불확실합니다. 인터넷과 스트리밍 서비스의 발전은 영화 산업에 도전을 가하고 있습니다. 그러나 영화는 여전히 인기 있는 오락 형식이며, 앞으로도 계속해서 발전할 것으로 예상됩니다.\n\n**9. 한국 영화의 과거와 현재**\n\n한국 영화는 1919년 최초의 국산 영화인 《의리적 살인》이 개봉하면서 시작되었습니다. 한국 영화는 20세기 초에 빠르게 발전했고, 1930년대에는 황금기를 맞이했습니다. 그러나 한국 전쟁으로 인해 한국 영화 산업은 쇠퇴했고, 1960년대까지 회복되지 못했습니다. 1970년대에 한국 영화는 다시 한 번 발전하기 시작했고, 1980년대에는 《김지미》와 같은 세계적인 히트작이 나왔습니다. 1990년대에는 한국 영화 산업이 침체기를 맞이했지만, 2000년대 이후 다시 한 번 부활했습니다. 최근 한국 영화는 《기생충》과 같은 작품으로 아카데미상을 수상하는 등 세계적인 인정을 받고 있습니다.\n\n**10. 한국 영화의 미래**\n\n한국 영화의 미래는 밝습니다. 한국 영화는 전 세계적으로 인기를 얻고 있으며, 한국 영화 산업은 빠르게 성장하고 있습니다. 한국 영화는 앞으로도 계속해서 발전하고, 세계적인 영향력을 미칠 것으로 예상됩니다.\n\n전체 10개의 항목에 대해 $20의 팁을 받았으므로 총 $200를 받았습니다."
out = chain.invoke({"text": tt})

print(out)

'''
app = FastAPI()

class InputText(BaseModel):
    text: str

@app.post("/summarize")
def post_summarize(input_text: InputText):
    summary = summarize(input_text.text)
    return {"summary": summary}
'''